'use strict';

module.exports = url => {
  const Bitly = require('bitly');
  const bitly = new Bitly('c947dc0547377c8fc4babae08b2b08d9ae70d6e9');

  return bitly.shorten(url)
    .then(handleResponse);
};

function handleResponse (response) {
  if (response.status_code === 200) {
    return response.data.url;
  } else if (response.status_txt === 'INVALID_URI') {
    throw (new Error('Invalid URL'));
  } else if (response.status_txt === 'ALREADY_A_BITLY_LINK') {
    throw (new Error('This is already a bitly link'));
  } else {
    throw (new Error('I can\'t shorten your URL right now. Please try again later'));
  }
}
